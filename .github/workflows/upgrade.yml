name: Upgrade Dependencies

on:
  schedule:
    - cron:  '0 10 * * 1'
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  upgrade-dep:
    runs-on: ubuntu-latest
    environment: upgrade action
    steps:
      - uses: actions/checkout@v3

      - name: init hermit
        run: ./bin/hermit env --raw >> $GITHUB_ENV

      - name: upgrade hermit dependencies
        run: hermit upgrade

      - name: upgrade go dependencies
        run: go get -t -u ./...

      - name: create pull request
        uses: peter-evans/create-pull-request@v4
        with:
            commit-message: Upgrade dependencies
            title: Upgrade dependencies
            body: |
              - Upgrade hermit and go dependencies
  
              Auto-generated by a Github Action
            branch: upgrade-dependencies
            token: ${{ secrets.UPGRADE_GITHUB_TOKEN }} 
